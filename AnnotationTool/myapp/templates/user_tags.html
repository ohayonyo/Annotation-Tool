<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}  <!-- Load the static template tag library -->
    <style>
       body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #imageListContainer {
            width: 50%;
            height: 100%;
            overflow-y: auto;
        }

        .image-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
        }

        .image-list-item {
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .canvas-container {
            position: relative;
        }

        .canvas-overlay {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair; /* Change cursor to crosshair for drawing */
        }
    </style>
    <title>Ordered Image List</title>
</head>
<body>

    <div id="imageListContainer">
        <div class="image-list" id="imageList"></div>
    </div>

    <!-- upload image lists -->
    <script>
        const imageArray = [
            "{% static 'pictures/image1.jpg' %}",
            "{% static 'pictures/image2.jpg' %}",
            "{% static 'pictures/image1.jpg' %}",
            "{% static 'pictures/image1.jpg' %}"
        ];
        const imageListContainer = document.getElementById('imageList');

        imageArray.forEach((imageName, index) => {
            const imageListItem = document.createElement('div');
            imageListItem.classList.add('image-list-item');

            const canvasContainer = document.createElement('div');
            canvasContainer.classList.add('canvas-container');
            imageListItem.appendChild(canvasContainer);

            const canvasElement = document.createElement('canvas');
            canvasContainer.appendChild(canvasElement);

            const image = document.createElement('img');
            image.src = imageName;
            image.alt = `Image ${index + 1}`;
            image.classList.add('canvas-overlay')
            canvasContainer.appendChild(image);
            imageListContainer.appendChild(imageListItem);
        });
    </script>

<!-- enables annotate -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Get all canvas elements and their associated images
        const canvases = document.querySelectorAll('canvas');
        const images = document.querySelectorAll('.canvas-overlay');

        // Loop through each canvas
        canvases.forEach((canvas, index) => {
            const arr = [];
            const context = canvas.getContext('2d');

            // Set canvas dimensions based on the associated image
            canvas.width = images[index].width;
            canvas.height = images[index].height;

            let isDrawing = false;
            let startX, startY, width, height;

            // Event listeners for drawing rectangles
            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                startX = e.offsetX;
                startY = e.offsetY;
            });

            canvas.addEventListener('mousemove', drawRectangle);
            canvas.addEventListener('mouseup', () => {
                if (isDrawing) {
                    isDrawing = false;
                    drawRectangle({ offsetX: startX, offsetY: startY }); // Draw rectangle on mouseup

                    for(let i=0;i<arr.length;i++){
                        context.strokeRect(arr[i][0], arr[i][1], arr[i][2], arr[i][3]);
                    }
                    context.strokeRect(startX, startY, width, height); // Draw rectangle
                    arr.push([startX,startY,width,height]);
                    console.log(arr)
                    
                }
            });

            function drawRectangle(e) {
                if (!isDrawing) return;

                width = e.offsetX - startX;
                height = e.offsetY - startY;

                context.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
                context.strokeStyle = '#000'; // Set stroke color
                context.lineWidth = 5; // Set line width

                context.strokeRect(startX, startY, width, height); // Draw rectangle
            }

            // Redraw the rectangle when the mouse leaves the canvas
            canvas.addEventListener('mouseleave', () => {
                if (isDrawing) {
                    context.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
                    context.strokeStyle = '#000'; // Set stroke color
                    context.lineWidth = 5; // Set line width
                    for(let i=0;i<arr.length;i++){
                        context.strokeRect(arr[i][0], arr[i][1], arr[i][2], arr[i][3]);
                    }
                    context.strokeRect(startX, startY, width, height); // Draw rectangle
                    arr.push([startX,startY,width,height]);
                    console.log(arr)
                }
            });
        });
    });
</script>

</body>
</html>