{% extends "base.html" %} {% block title %} Upload image page {% endblock %}
{% block content %}
{% load static %}
<div style="text-align: center; font-size: 24px;">
  <p>Upload image page</p>
</div>

<form enctype="multipart/form-data" id="uploadForm">
    {% csrf_token %}
    <label for="imageInput">Select an image:</label>
    <input type="file" id="imageInput" name="image" accept="image/*" onchange="previewImage(event)">
</form>

<div id="imagePreview" style="display:none;">
    <p>Preview:</p>
    <img id="preview" src="" alt="Image preview" style="max-width: 300px;">
</div>

<canvas id="myCanvas" width="800" height="600">

  
</canvas>

<script>
  // Get the canvas element and its 2d context
  var canvas = document.getElementById('myCanvas');
  var context = canvas.getContext('2d');

  // Get the image element
  var image = document.getElementById('preview');

  // Draw the image on the canvas
  context.drawImage(image, 0, 0, canvas.width, canvas.height);

  // Initialize rectangle points
  var rectPoints = {
    x1: 0,
    y1: 0,
    x2: 0,
    y2: 0
  };

  // Flag to track whether the first or second point is being clicked
  var firstPointClicked = false;

  // Event listener for mouse clicks on the canvas
  canvas.addEventListener('click', function(event) {
    // Get the mouse coordinates relative to the canvas
    var rect = canvas.getBoundingClientRect();
    var mouseX = event.clientX - rect.left;
    var mouseY = event.clientY - rect.top;

    // Update rectangle points based on whether it's the first or second point
    if (!firstPointClicked) {
      rectPoints.x1 = mouseX;
      rectPoints.y1 = mouseY;
      firstPointClicked = true;
    } else {
      rectPoints.x2 = mouseX;
      rectPoints.y2 = mouseY;

      // Draw the rectangle on the canvas
      context.strokeStyle = 'red'; // Set the stroke color
      context.lineWidth = 2;      // Set the stroke width
      context.rect(rectPoints.x1, rectPoints.y1, rectPoints.x2 - rectPoints.x1, rectPoints.y2 - rectPoints.y1);
      context.stroke();

      // Reset for the next rectangle
      firstPointClicked = false;
    }
  });
</script>


<!-- <canvas id="annotationCanvas" width="800" height="600"></canvas>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var canvas = document.getElementById('annotationCanvas');
      var context = canvas.getContext('2d');
      var image = new Image();

      // Replace 'path/to/your/image.jpg' with the actual path to your image file.
      image.src = 'path/to/your/image.jpg';

      image.onload = function () {
        context.drawImage(image, 0, 0, canvas.width, canvas.height);
      };

      var isDrawing = false;

      canvas.addEventListener('mousedown', function (e) {
        isDrawing = true;
        draw(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop, false);
      });

      canvas.addEventListener('mousemove', function (e) {
        if (isDrawing) {
          draw(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop, true);
        }
      });

      canvas.addEventListener('mouseup', function () {
        isDrawing = false;
        context.beginPath();
      });

      function draw(x, y, isDrawing) {
        if (!isDrawing) {
          context.beginPath();
        }
        context.lineWidth = 2;
        context.lineCap = 'round';
        context.strokeStyle = '#ff0000'; // Red color for annotation lines

        context.lineTo(x, y);
        context.stroke();
        context.beginPath();
        context.moveTo(x, y);
      }
    });
  </script> -->

<script src="{% static 'js/upload_image.js' %}"></script>

{% endblock %}
