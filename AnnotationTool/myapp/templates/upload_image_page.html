{% extends "base.html" %} {% block title %} Upload image page {% endblock %}
{% block content %}
{% load static %}
<div style="text-align: center; font-size: 24px;">
  <p>Upload image page</p>
</div>

<div enctype="multipart/form-data" id="uploadForm">
  {% csrf_token %}
  <label for="imageInput">Select an image:</label>
  <input type="file" id="imageInput" name="image" accept="image/*" onchange="previewImage(event)">
  <button id="submitButton" onclick="updateImage()" style="border: solid 1px; background-color: lightgray;">submit</button>
  <button onclick="updateImage()">clear</button>
</div>

<canvas id="myCanvas" width="800" height="600">
  <div id="imagePreview" style="display:none;">
    <p>Preview:</p>
    <img id="preview" src="" alt="Image preview" style="max-width: 300px;">
  </div>
</canvas>

<script>
var canvas = document.getElementById('myCanvas');
var context = canvas.getContext('2d');
var image = document.getElementById('preview');
var rectPoints = {
  x1: 0,
  y1: 0,
  x2: 0,
  y2: 0
};
var firstPointClicked = false;

function previewImage(event) {
  var input = event.target;
  var reader = new FileReader();

  reader.onload = function(){
    image.src = reader.result;
  };
  image.onload = function() {
    context.clearRect(0, 0, canvas.width, canvas.height); 
    context.drawImage(image, 0, 0, canvas.width, canvas.height);

    if (firstPointClicked) {
      context.strokeStyle = 'red';
      context.lineWidth = 2;
      context.rect(rectPoints.x1, rectPoints.y1, rectPoints.x2 - rectPoints.x1, rectPoints.y2 - rectPoints.y1);
      context.stroke();
    }
  };


  reader.readAsDataURL(input.files[0]);
  document.getElementById('imagePreview').style.display = 'block';
}

canvas.addEventListener('click', function(event) {
  var rect = canvas.getBoundingClientRect();
  var mouseX = event.clientX - rect.left;
  var mouseY = event.clientY - rect.top;

  
  if (!firstPointClicked) {  
    context.clearRect(0, 0, canvas.width, canvas.height); 
    context.drawImage(image, 0, 0, canvas.width, canvas.height);
    rectPoints.x1 = mouseX;
    rectPoints.y1 = mouseY;
    firstPointClicked = true;
  } else {
    rectPoints.x2 = mouseX;
    rectPoints.y2 = mouseY;

  
    context.clearRect(0, 0, canvas.width, canvas.height); 
    context.drawImage(image, 0, 0, canvas.width, canvas.height);

    context.strokeStyle = 'red';
    context.lineWidth = 2;
    context.rect(rectPoints.x1, rectPoints.y1, rectPoints.x2 - rectPoints.x1, rectPoints.y2 - rectPoints.y1);
    context.stroke();

    firstPointClicked = false;
  }
});

document.getElementById('imageInput').addEventListener('change', f);

function updateImage() {
  context.clearRect(0, 0, canvas.width, canvas.height); 
  context.drawImage(image, 0, 0, canvas.width, canvas.height);
}

</script>

<!-- <canvas id="annotationCanvas" width="800" height="600"></canvas>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var canvas = document.getElementById('annotationCanvas');
      var context = canvas.getContext('2d');
      var image = new Image();

      // Replace 'path/to/your/image.jpg' with the actual path to your image file.
      image.src = 'path/to/your/image.jpg';

      image.onload = function () {
        context.drawImage(image, 0, 0, canvas.width, canvas.height);
      };

      var isDrawing = false;

      canvas.addEventListener('mousedown', function (e) {
        isDrawing = true;
        draw(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop, false);
      });

      canvas.addEventListener('mousemove', function (e) {
        if (isDrawing) {
          draw(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop, true);
        }
      });

      canvas.addEventListener('mouseup', function () {
        isDrawing = false;
        context.beginPath();
      });

      function draw(x, y, isDrawing) {
        if (!isDrawing) {
          context.beginPath();
        }
        context.lineWidth = 2;
        context.lineCap = 'round';
        context.strokeStyle = '#ff0000'; // Red color for annotation lines

        context.lineTo(x, y);
        context.stroke();
        context.beginPath();
        context.moveTo(x, y);
      }
    });
  </script> -->

<script src="{% static 'js/upload_image.js' %}"></script>

{% endblock %}
